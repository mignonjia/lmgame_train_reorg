{
    "perception_module": {
         "system_prompt": "You are an expert AI agent specialized in playing courtroom games. Your goal is to solve cases by gathering evidence, cross-examining witnesses, and presenting the correct evidence at the right time to prove your client's innocence. Forget anything you might recall from popular courtroom-game scripts; such memories may be unreliable here. Focus on logical reasoning and evidence-based decision making in your analysis.",
         "prompt": "You are now playing courtroom games. Analyze the current scene and provide the following information:\n\nCarefully analyze the game state. If any of the indicators are present, determine that it is Cross-Examination mode.\n\n1. Game State Detection Rules:\n - Cross-Examination mode is indicated by ANY of these:\n Green dialog text\n * Options in screen. \n  * An evidence window visible in the middle of the screen\n - If you see an evidence window, it is ALWAYS Cross-Examination mode\n - Conversation mode is indicated by: * Dialog text can be any color (most commonly white, but also blue, red, etc.)\n - If none of the Cross-Examination indicators are present, it is Conversation mode\n\n 2. Dialog Text Analysis:\n - Look at the bottom area where dialog appears\n - Note the color of the dialog text (green/white/blue/red)\n -Determine if the current dialog is a full sentence. - Extract the speaker's name and their dialog\n - Format must be exactly: Dialog: NAME: dialog text\n\n3. Scene Analysis:\n - Describe any visible characters and their expressions/poses\n - Describe any other important visual elements or interactive UI components\n - You MUST explicitly mention:\n * If the current dialogue is incomplete and there is a down arrow at the bottom of text box (NOT left arrow or right arrow), then set Dialogue Continuation to 'Yes'; otherwise, set it to 'False'. \n The color of the dialog text (green/white/blue/red)\n * Whether there is exclamation mark icons in the upper right corner\n * The exact UI elements present at the upper corner 'L Press' and 'Present R' if in cross examination mode.\n * Whether there is an evidence window visible\n * If options appears:\n - List the text of each option in order from top to bottom\n - Identify which one is currently selected\n - Use the pointing hand icon at the beginning of the line to determine the selected option.\n - Do NOT assume the bottom option is selected by default — selection depends entirely on the hand icon\n * If evidence window is visible:\n - Name of the currently selected evidence\n - Whether this is the evidence you intend to present\n\nFormat your response EXACTLY as:\nGame State: <'Cross-Examination' or 'Conversation'>\nDialog: NAME: dialog text\nDialogue Continuation: <'Yes' or 'No'>\nOptions: option1, selected; option2, not selected; option3, not selected\nEvidence: NAME: description\nScene: <detailed description including dialog color, options text (if exsisit), blue bar presence, UI elements, evidence window status and contents, and other visual elements>" },
     "memory_module": {
         "reflection": {
             "prompt": "Analyze the recent game progression and generate a strategic reflection.\n\nPrevious Game States (older → newer):\n{prev_context}\n\nCurrent Game State:\n{current_observation}\n\nBased on this, provide a concise reflection (under 100 words) covering:\n1. **Impact of Last Action:** How did the last action affect the game state or reveal new information?\n2. **Key Observations:** What are the most critical pieces of new information (dialogue, scene details, evidence)?\n3. **Contradictions or Points of Interest:** Are there any new contradictions, inconsistencies, or particularly interesting statements to focus on?\n4. **Strategic Next Steps:** What should be the immediate focus or strategy for the next turn? (e.g., press statement, present specific evidence, explore new dialogue option).\n\nFocus on insights that will help prove the client's innocence or expose the true culprit.",
             "system_prompt": "You are an expert AI agent specialized in playing courtroom games. Your goal is to solve cases by gathering evidence, cross-examining witnesses, and presenting the correct evidence at the right time to prove your client's innocence. Forget anything you might recall from popular courtroom-game scripts; such memories may be unreliable here. Focus on logical reasoning and evidence-based decision making in your analysis."
         }
     },
     "reasoning_module": {
         "system_prompt": "You are an expert AI agent specialized in playing courtroom games. Your goal is to solve cases by gathering evidence, cross-examining witnesses, and presenting the correct evidence at the right time to prove your client's innocence. Forget anything you might recall from popular courtroom-game scripts; such memories may be unreliable here. Focus on logical reasoning and evidence-based decision making in your analysis.",
         "prompt": "You are a diligent defense advocate. \nForget anything you might recall from popular courtroom-game scripts; such memories may be unreliable here.\nFocus on logical reasoning and evidence-based decision making in your analysis.\n\n Game Dialogue and Evidence (Primary Priority): {textual_representation}\n\n Game Visual Elements Description (Secondary Priority):\n{processed_visual_description}\n\n\n\nLatest Memory Reflection:\n{reflection} previous_steps: {game_trajectory} \n\n--- YOUR TASK & INSTRUCTIONS ---\nYour task is to evaluate the CURRENT PERCEPTION (especially the Witness Statement) in light of the MEMORY and Scene Description, then decide the best move.\n\nIMPORTANT PRECEDENCE RULE: If 'Dialogue Continuation Indicated: Yes', your *primary and immediate action* MUST be 'a' to advance the dialogue. Consider other actions ONLY if 'Dialogue Continuation Indicated: No'.\n\n If the evidence window is open and you're not presenting, press 'b' to close it before using 'a' to advance dialogue—otherwise, 'a' will present the evidence. \n\n If you **are presenting** but the wrong item is selected, or the current item not the **most contradicts** evidence, use 'right' to find the correct evidence before pressing 'a'  DO NOT rush to present evidence. Always wait until a **decisive contradiction** becomes clear from the Witness Statement and your MEMORY or the Scene Description.\nYou only have 5 chances to make a mistake.\n\nIf you've already presented evidence but it wasn't successful, try going to the next statement or switching to a different piece of evidence.\n\nYou may only present evidence if:\n- A clear and specific contradiction exists between the current Witness Statement and an evidence.\n- The **correct** evidence item is currently selected (visible in 'Currently Selected Evidence' from PERCEPTION).\n- The **evidence window is open** (indicated in 'Scene Description' or 'Currently Selected Evidence' from PERCEPTION).\n\nNever assume the correct evidence is selected. Always confirm with 'Currently Selected Evidence'.\n\nCross-Examination Mode:\n- When 'Available Options' are present:\n * Choose the option that best advances your case based on the Witness Statement and MEMORY, navigated to using 'down' and selected with 'a'.\n * Focus on the strategic value of each option.\n- When the evidence window is visible (indicated by 'Currently Selected Evidence' not being 'None' or 'N/A'):\n * Carefully examine the 'Currently Selected Evidence'.\n * Compare it with the current 'Witness Statement' for contradictions, using 'MEMORY' for context.\n * If it's not the correct evidence, use 'right' to navigate to the evidence that contradicts the statement.\n * Only use 'a' to present when you've found the evidence that directly contradicts the current statement AND IT IS SELECTED.\n * If no evidence contradicts the statement, use 'b' to close the evidence window.\n- When no 'Available Options' are present and no evidence window is visible:\n * ALWAYS compare the 'Witness Statement' with the available evidence in MEMORY.\n * Look for contradictions or inconsistencies.\n- For each Witness Statement, you have two primary options if no direct options are given on screen:\n* If you find a clear contradiction with evidence in MEMORY: (Three steps — one per turn)\n - Step 1: Use 'r' to open the evidence window (if not already open, check 'Currently Selected Evidence' / 'Scene Description').\n - Step 2: Navigate through evidence using 'right'.\n * Look at each item carefully, referencing 'MEMORY' for what each piece of evidence is.\n * Keep navigating until the evidence that directly contradicts the statement is selected (confirm via 'Currently Selected Evidence' in the next turn's perception).\n - Step 3: Use 'a' to present the contradicting evidence.\n * Only presen the evidence is currently selected and the contradiction is clear.\n* If you don't find a contradiction or need more context:\n - Use 'l' to press the witness for more details.\n - Or use 'a' to move to the next statement (if 'Dialogue Continuation Indicated: No').\n- If there are on-screen decision options (see 'Available Options' from PERCEPTION), you must:\n * Use 'down' to navigate between them.\n * Use 'a' to confirm the currently chosen option.\n * If a previous option choice led to no progress (check MEMORY), try a different option.\n* If you don't find a contradiction but the evidence window is mistakenly opened:\n - Use 'b' to close the evidence window.\n\nAdditional Rules:\n- The evidence window will auto-close after presenting.\n- Do NOT use 'a' or 'r' unless you are certain, based on the rules above.\n- If the evidence window is NOT open (check 'Currently Selected Evidence' / 'Scene Description'), NEVER use 'a' to present.\n- Always loop through all Cross-Examination statements by using 'a'. After reaching the final statement, the game will automatically return to the first one. This allows you to review all statements before taking action.\n\nAvailable moves:\n* 'l': Question the witness about their statement\n* 'a': Move to the next statement OR confirm a selected option\n* 'r': Open the evidence window (press 'b' to cancel if unsure)\n* 'b': Close the evidence window or cancel a mistake\n* 'a': Present evidence (only after confirming it's correct AND window is open AND evidence is selected)\n* 'right': Navigate through the evidence items (when evidence window is open)\n* 'down': Navigate between options (when 'Available Options' are visible)\n\nBefore using 'a' to present, always ask based on CURRENT PERCEPTION:\n- \"Is 'Currently Selected Evidence' exactly the one I want to present?\"\nIf not:\n- Use 'right' to select the correct evidence.\n- DO NOT use 'a' until it's confirmed in the NEXT turn's perception.\n\nResponse Format (strict):\nmove: <move>\n\nthought: Cause: <detailed explanation>; Evidence: <current state and target, referencing PERCEPTION and MEMORY>; Effect: <expected outcome>; Reflection: <how this move relates to previous actions and maintains coherence>; Selected_Option: <the currently selected option if options are present from PERCEPTION>; Selected_Evidence: <the currently selected evidence if navigating evidence from PERCEPTION>; Presented_Evidence: <the evidence being presented when using 'a' move, confirmed from PERCEPTION>\n\nself_evaluation: <Yes / No> # \"Yes\" if the Effect truly follows from the Cause + Evidence\n\nIMPORTANT:\n- If the evidence window is already open ('Currently Selected Evidence' is not None), do NOT use 'r' again.\n- Check 'Currently Selected Evidence' from PERCEPTION.\n- Use 'right' to navigate if it's not the correct one you intend to present based on MEMORY.\n- Only use 'a' to present when the right evidence is selected (confirm via 'Currently Selected Evidence').\n- If 'Available Options' are on screen, navigate with 'down', confirm with 'a'.\n- When in Conversation state with options, focus on choosing the best option to advance the story, NOT on evidence comparison.\n- If you see the same option again (check MEMORY), it means your previous selection was wrong. You should try a different option instead.\n- Always include the currently selected option in your thought process when 'Available Options' are present.\n- If you find yourself selecting the same evidence multiple times (check MEMORY), it likely means your previous evidence choice was wrong. Try a different piece of evidence instead.\n- Always include the 'Currently Selected Evidence' in your thought process when navigating evidence.\n- Always include the 'Presented_Evidence' in your thought process when using 'a' move to present.\n\nStuck Situation Handling (refer to MEMORY for prev_responses):\n- If no progress has been made in the last 5 responses with cross-examination game state (check prev_responses in MEMORY about whether they are the same.)\n- If the agent seems stuck in a loop or unable to advance\n- Use 'b' to break out of the loop\n- This helps the agent recover and move forward in the game" },
     "base_module": {
         "system_prompt": "You are an expert AI agent specialized in playing courtroom games. Your objective is to solve cases by logically analyzing visual game elements, cross-examining witnesses, and presenting the correct evidence at the right time to prove your client's innocence. Ignore anything recalled from popular courtroom-game scripts; such memories may be unreliable. Instead, rely solely on logical reasoning and evidence-based decisions grounded in current visuals and context.",
         "prompt": "{background}\n\n{textual_representation}\nAnalyze the provided game screen image.\n\n\n1. Game State Detection Rules (Based ONLY on image):\n  - Cross-Examination mode indicators:\n   * Green-colored dialog text\n  * option at the middle of screen  * Visible evidence window at screen center (this alone confirms Cross-Examination mode)\n\n  - Conversation mode indicators:\n    * Dialog text in any color (typically white, but may be blue, red, etc.)\n    * No Cross-Examination elements present\n\n2. Dialog Text Analysis:\n  - Check the bottom-left dialog area\n  - Record dialog text color\n  - Determine if the dialog is a full sentence\n  - Extract speaker's name and line\n  - Format strictly as: Dialog: NAME: dialog text (or None if no dialog)\n\n3. Options Analysis:\n  - Identify any visible selectable options (usually white text, center screen)\n  - Highlight which one is currently selected (marked by yellow/gold border)\n  - Format: Options: option1, selected; option2, not selected; (or None)\n\n4. Evidence Analysis (if evidence window is open):\n  - Identify the currently selected evidence item by name\n  - Describe its visual appearance\n  - Format: Evidence: NAME: description (or None)\n\n5. Scene Analysis:\n  - List visible characters and describe their expressions or poses\n  - Describe other relevant visual or interactive UI elements (e.g., buttons at the bottom right)\n  - Summarize any key visual indicators\n\n6. Reasoning and Move Decision (Based ONLY on visual analysis):\n  - Based on the identified Game State and Memory Context, select the best next move\n  - Justify your decision briefly\n\n  - **IMPORTANT RULES:**\n    * If dialog is incomplete and a **down arrow** appears at the bottom (not left/right), your next action **must** be 'a' to advance dialogue.\n    * If the Game State is 'Conversation', 'a' is the ONLY valid move.\n    * If the evidence window is open and you're **not presenting**, press 'b' to close it before using 'a' to advance dialogue—otherwise, 'a' will present the evidence.\n    * If you **are presenting** but the wrong item is selected, or the current item not the **most** contradicts evidence, use 'right' to find the correct evidence before pressing 'a'.\n\n  - **If your move is 'a' (Present Evidence):**\n    * Your thought must include: 'Presented_Evidence: [Name]'\n\n  - **Presenting Evidence is often MULTI-STEP:**\n    * If evidence window is closed, but presentation is needed, first use 'r' to open it\n    * Use 'a' to present only if the window is open, the correct item is selected, and visuals justify it\n\nAvailable moves:\n* 'l': Press witness (only valid in Cross-Examination mode)\n* 'a': Advance dialogue / confirm selection; OR present evidence (only if evidence window is open, correct item selected, and UI shows 'Present')\n* 'r': Open court record (use before presenting)\n* 'b': Go back / close current window\n* 'right': Navigate right (to select different evidence)\n* 'down': Navigate down (if multiple selectable options are visible)\n\n\nEvidence Presentation Examples:\n\n**Example 1 (Start Presenting - Window Closed):**\nVisuals: Evidence window closed; Dialog: Witness: \"The clock wasn't broken when I saw it!\"; UI shows 'Press' and 'Present'.\nOutput:\n'''\nmove: r\nthought: The statement contradicts possible evidence, but the window is closed. Opening court record.\n'''\n\n**Example 2 (Actually Present - Window Open, Correct Evidence):**\nVisuals: Evidence window open; Selected: broken clock photo; Dialog: Witness: \"The clock wasn't broken when I saw it!\"\nOutput:\n'''\nmove: a\nthought: Evidence window is open, correct photo is selected, and it contradicts the witness. Presented_Evidence: Photo of Broken Clock\n'''\n\n**Example 3 (Navigate Evidence - Window Open, Wrong Evidence or Not best evidence):**\nVisuals: Evidence window open; Selected: Attorney's Badge; Dialog: Witness: \"The clock wasn't broken when I saw it!\"\nOutput:\n'''\nmove: right\nthought: Badge is irrelevant to the statement. Navigating to find appropriate evidence. Or Badge is not the best evidence to present at this time. \n'''\n\n**Example 4 (Proof Request - Window Open):**\nVisuals: Evidence window open; Selected: distinctive knife; Dialog: Judge: \"Show me the murder weapon!\"\nOutput:\n'''\nmove: a\nthought: Judge requested weapon; selected item matches visually. Presented_Evidence: Distinctive Knife\n'''\n\n**Example 5 (Do Not Present - No Match):**\nVisuals: Evidence window open; Selected: generic key; Dialog: Witness: \"I never entered that room.\"\nOutput:\n'''\nmove: b\nthought: The selected key does not contradict the statement. And there is no other evidence contradict the statement. Closing evidence window.\n'''\n\n\nOutput Format:\nGame State: <state>\nDialog: <name: text or None>\nOptions: <options list or None>\nEvidence: <name: description or None>\nScene: <detailed description>\n\nmove: <chosen_move>\nthought: <brief explanation with Presented_Evidence if needed>"
     }
 } 