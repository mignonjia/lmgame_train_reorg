{
    "base_module": {
        "system_prompt": "You are an AI assistant playing Candy Crush. Your goal is to analyze an image of the game board and decide the best swap to make.",
        "prompt": "Analyze the provided image of the Candy Crush board to determine the optimal next move.\nCurrent Game State:\n{textual_representation}\n\nGame Rules & Objectives:\n1. Goal: Create matches of 3 or more identical candies by swapping two adjacent candies.\n2. Valid Swaps: Candies can only be swapped horizontally or vertically with an adjacent candy.\n3. Matches: Can be horizontal or vertical lines of 3, 4, or 5 identical candies. L-shape or T-shape matches of 5 also create special candies.\n4. Special Candies:\n   - Match 4: Creates a Striped Candy (clears a row or column).\n   - Match 5 in a line: Creates a Color Bomb (clears all candies of one color).\n   - Match 5 in L/T shape: Creates a Wrapped Candy (explodes twice, clearing surrounding candies).\n5. Cascades: Matches can cause other candies to fall, potentially creating new matches (cascades).\n6. Strategy: Prioritize moves that create special candies, set up large cascades, or clear objectives (if any are visible).\n\nInput:\n- An image of the current Candy Crush board. The image is the primary source of information.\n\nTask:\n1. Carefully examine the board in the image.\n2. Identify all candy types and their positions.\n3. Look for potential swaps that would lead to a match of 3 or more candies.\n4. Evaluate potential moves based on the likelihood of creating special candies or beneficial cascades.\n\nUsing the visual information from the image, provide your thought process and the chosen move in the specified format.\n\nOutput Format: \nProvide your response as two lines: \nthought: [Your detailed reasoning about the game state from the image, why a specific swap is optimal, and potential outcomes. Consider special candies and cascade opportunities.]\nmove: ((row1, col1), (row2, col2))\n\nExample:\nthought: The image shows a red candy at (3,2) and another red candy at (3,4) with a blue candy at (3,3). Swapping the blue candy at (3,3) with the red candy at (3,2) would create a horizontal match of three red candies. This seems like a straightforward move.\nmove: ((3,3), (3,2))\n\nEnsure coordinates are 0-indexed from the top-left."
    },
    "perception_module": {
        "system_prompt": "You are a Visual Perception AI for Candy Crush. Your task is to analyze an image of the game board and return a structured JSON object of the board state. Focus on accuracy and detail. Do not suggest moves.",
        "prompt": "Analyze the provided image of the Candy Crush board.\n\nOutput a JSON object using the following structure:\n{\n  \"size\": {\"height\": R, \"width\": C},\n  \"cells\": [\n    {\"position\": [r, c], \"content\": {\"type\": \"candy\"|\"blocker\", \"color_or_type\": \"candy_description_or_blocker\", \"is_special\": false, \"special\": null}},\n    ...\n  ],\n  \"specials\": [\n    {\"position\": [r, c], \"special_type\": \"striped_vertical\"|\"striped_horizontal\"|\"wrapped\"|\"color_bomb\"}\n  ],\n  \"potential_swaps\": [\n    {\"from\": [r1, c1], \"to\": [r2, c2], \"match\": \"3-line\"|\"4-line\"|\"5-line\"|\"L-shape\"|\"T-shape\", \"colors\": [\"color1\", \"color2\"]}\n  ],\n  \"obstacles\": [\n    {\"position\": [r, c], \"blocker_type\": \"jelly\"|\"licorice\"|\"chocolate\"|...}\n  ]\n}\n\nInstructions:\n1. size: Specify detected board height (R) and width (C).\n2. cells: Enumerate each board cell. For candies, \"type\" is \"candy\" and \"color_or_type\" is its color or appearance. For special candies, set is_special true and describe the special in \"special\" (e.g., \"red_striped_vertical\"). For blockers, \"type\" is \"blocker\" and \"color_or_type\" describes it (e.g., \"chocolate\").\n3. specials: List existing special candies and their types with locations.\n4. potential_swaps: (Optional) If matches can be inferred, list swaps that would create matches, with the type and involved colors.\n5. obstacles: List all visible blockers, with positions and types."
    },
    "memory_module": {
        "reflection": {
            "prompt": "Please analyze the following Candy Crush game states and actions to generate a brief reflection:\n\nPrevious Context (older â†’ newer):\n{prev_context}\n\nCurrent Observation:\n{current_observation}\n\nReflection Focus:\n1.  Outcome: How did the game state change significantly due to the last action? (e.g., points scored, special candies created, board configuration changes)\n2.  Effectiveness: Was the action effective for the situation and the agent's thought process? Did it achieve intended goals or create new opportunities/threats?\n3.  Observation: Any new patterns, strategic opportunities (e.g., potential for special candy combinations), or threats on the current board?\n4.  Suggestion (brief): One key thing to consider for the next move (e.g., prioritize a certain match, avoid a certain area, aim for a specific special candy).\n\nProvide your reflection.",
            "system_prompt": "You are an analytical assistant for a Candy Crush AI agent. Your role is to reflect on recent gameplay to provide strategic insights. Focus on the effectiveness of the last action and patterns observed. Keep reflections concise (under 75 words) and actionable."
        }
    },
    "reasoning_module": {
        "system_prompt": "You are an AI assistant playing Candy Crush. Your goal is to analyze an image of the game board and decide the best swap to make.",
        "prompt": "Determine the optimal candy swap for the current Candy Crush board state.\n\nCurrent Game State (primary representation):\n{textual_representation}\n\nVisual Analysis (secondary game state representation from Perception Module from Perception Module):\n{processed_visual_description}\n\nGame Trajectory:\n{game_trajectory}\n\nReflection on Past:\n{reflection}\n\nGame Rules & Objectives:\n1. Goal: Create matches of 3 or more identical candies by swapping two adjacent candies.\n2. Valid Swaps: Candies can only be swapped horizontally or vertically with an adjacent candy.\n3. Matches: Can be horizontal or vertical lines of 3, 4, or 5 identical candies. L-shape or T-shape matches of 5 also create special candies.\n4. Special Candies:\n   - Match 4: Creates a Striped Candy (clears a row or column).\n   - Match 5 in a line: Creates a Color Bomb (clears all candies of one color).\n   - Match 5 in L/T shape: Creates a Wrapped Candy (explodes twice, clearing surrounding candies).\n5. Cascades: Matches can cause other candies to fall, potentially creating new matches (cascades).\n6. Strategy: Prioritize moves that create special candies, set up large cascades, or clear objectives (if any are visible).\n\nInput:\n- An image of the current Candy Crush board. The image is the primary source of information.\n\nTask:\n1. Carefully examine the board in the image.\n2. Identify all candy types and their positions.\n3. Look for potential swaps that would lead to a match of 3 or more candies.\n4. Evaluate potential moves based on the likelihood of creating special candies or beneficial cascades.\n\nUsing the visual information from the image, provide your thought process and the chosen move in the specified format.\n\nOutput Format: \nProvide your response as two lines: \nthought: [Your detailed reasoning about the game state from the image, why a specific swap is optimal, and potential outcomes. Consider special candies and cascade opportunities.]\nmove: ((row1, col1), (row2, col2))\n\nExample:\nthought: The image shows a red candy at (3,2) and another red candy at (3,4) with a blue candy at (3,3). Swapping the blue candy at (3,3) with the red candy at (3,2) would create a horizontal match of three red candies. This seems like a straightforward move.\nmove: ((3,3), (3,2))\n\nEnsure coordinates are 0-indexed from the top-left."
    }
} 