{
    "memory_module": {
        "reflection": {
            "prompt": "You are the memory module of a Tetris-playing AI. Your task is to reflect on the current game state and provide insights.\n\nPrevious Context (older → newer):\n{prev_context}\n\nCurrent Observation:\n{current_observation}\n\nPlease provide a reflection on the current game state. Consider:\n1. How has the board changed since previous states?\n2. Was the last move (and thought process) effective?\n3. What areas of the board need attention?\n4. Any strategic insights for future moves?\n\nReflection:",
            "system_prompt": "You are the memory module of a Tetris-playing AI that provides concise strategic reflections."
        }
    },
    "reasoning_module": {
        "system_prompt": "You are an AI assistant playing Tetris. Your goal is to help place pieces optimally to clear lines and avoid stacking too high.\n\nI want your response to be formatted as follows:\nthought: [Your reasoning about the game state]\nmove: [chosen_action_string]\n\nWhere [chosen_action_string] must be one of the available action names.",
        "prompt": "Analyze this Tetris game state and plan the optimal next move.\n\nCurrent Game State (primary representation):\n{textual_representation}\n\nVisual Analysis (secondary representation from Perception Module):\n{processed_visual_description}\n\nGame Trajectory:\n{game_trajectory}\n\nReflection on Past:\n{reflection}\n\nInterpreting Game State Information:\n1. If `processed_visual_description` is available and contains structured data (e.g., \"board_state\", \"active_piece\", \"next_pieces_ids\", \"game_stats\"), prioritize using these fields for your analysis. This comes from the Perception Module.\n2. If `processed_visual_description` is not available or lacks detail, use `textual_representation`. This text typically includes:\n    - The game board as a 2D array (where non-zero values represent pieces, and the active piece is already rendered on this board).\n    - \"N:[next_piece_ids]\" for upcoming pieces.\n    - \"S:score L:lines_cleared V:level\" for game statistics.\n3. If image is available, you can use it for visual context, especially if you are a multimodal model.\n4. From the available information, identify the current board layout, the active falling piece, its shape, and upcoming pieces.\n\nTetris Game Mechanics:\n1. The game board is a grid where pieces (tetrominoes) fall from the top.\n2. Your goal is to clear lines by filling all cells in a row, which removes that row.\n3. The game ends if the pieces stack up to the top of the board.\n\nAvailable Actions (Numerical for reference, use string names for 'move'):\n0: move_left - Move piece one cell to the left\n1: move_right - Move piece one cell to the right\n2: move_down - Move piece one cell down (corresponds to 'soft_drop')\n3: rotate_clockwise - Rotate piece 90 degrees clockwise (corresponds to 'rotate_right')\n4: rotate_counterclockwise - Rotate piece 90 degrees counterclockwise (corresponds to 'rotate_left')\n5: hard_drop - Drop piece to the bottom instantly (RECOMMENDED for final placement)\n6: swap - Swap with held piece (if available, though not in current env action list)\n7: no_operation - Do nothing (corresponds to 'no_op')\n\nAction Format for your response (MUST use these exact string names):\n- \"no_op\": Do nothing for this step.\n- \"left\": Move the current piece one cell to the left.\n- \"right\": Move the current piece one cell to the right.\n- \"rotate_left\": Rotate the current piece 90 degrees counter-clockwise.\n- \"rotate_right\": Rotate the current piece 90 degrees clockwise.\n- \"soft_drop\": Move the current piece one cell down.\n- \"hard_drop\": Instantly drop the current piece to its lowest possible position.\n\nExamples of common action sequences (using numerical actions for brevity in example, you should output string names):\n- [3, 1, 1, 5] → Rotate once clockwise, move right twice, then hard drop\n- [3, 3, 0, 0, 5] → Rotate twice clockwise, move left twice, then hard drop\n- [1, 1, 1, 5] → Move right three times, then hard drop\n- [0, 0, 0, 3, 5] → Move left three times, rotate once, then hard drop\n\nTetromino Shapes (infer from `textual_representation`):\nI-piece (line):\nRotation 0: IIII\nRotation 1: I\n           I\n           I\n           I\n\nO-piece (square):\nOnly one rotation: OO\n                   OO\n\nT-piece:\nRotation 0:  T\n            TTT\nRotation 1: T\n            TT\n            T\nRotation 2: TTT\n             T\nRotation 3:  T\n            TT\n            T\n\nL-piece:\nRotation 0:   L\n             LLL\nRotation 1: L\n            L\n            LL\nRotation 2: LLL\n            L\nRotation 3: LL\n             L\n             L\n\nJ-piece:\nRotation 0: J\n            JJJ\nRotation 1: JJ\n            J\n            J\nRotation 2: JJJ\n              J\nRotation 3:  J\n             J\n             JJ\n\nS-piece:\nRotation 0:  SS\n            SS\nRotation 1: S\n            SS\n             S\n\nZ-piece:\nRotation 0: ZZ\n             ZZ\nRotation 1:  Z\n            ZZ\n            Z\n\nGuidelines for planning:\n1. Start with any necessary rotations ('rotate_right' or 'rotate_left')\n2. Then position the piece horizontally ('left' or 'right')\n3. Finally, use 'hard_drop' for final placement\n4. Consider the next pieces in queue when planning your current move\n5. Carefully analyze the information from `processed_visual_description` and/or `textual_representation`.\n6. If using `textual_representation`, remember the board shown already includes the active piece. Determine its shape and position.\n7. Use `reflection` and `game_trajectory` for high-level strategic guidance and historical context.\n8. Aim to create complete lines and avoid creating holes.\n9. Think about the immediate best moves for the current step.\n\nYour task is to select the best moves for the current piece and board state.\n\nExample response (adapt based on available information):\nthought: [Your detailed reasoning. If `textual_representation` is primary, describe the inferred active piece, e.g., \"The textual_representation shows an L-piece near the top. Rotating it right...\" If `processed_visual_description` is primary, use its fields. The `reflection` suggests X.]\nmove: rotate_right\n\nFormat your response exactly as follows:\nthought: [Your detailed reasoning about the optimal move and why, using all available information fields]\nmove: (action_name_from_list, frame_count)\n\n--- RESPONSE EXAMPLE START ---\nthought: The current piece is an L-shape. The textual_representation shows it near the top left. The rotation visualizations indicate that rotating it right (clockwise once) and moving it right by 2 positions would allow it to fit into a gap on the right side, clearing one line. The next piece is an I, which could then be used to clear multiple lines if the current L is placed well. The Game Stats show a good performance score, so maintaining clean stacks is important. Reflection from past suggests prioritizing line clears over complex setups.\nmove: (rotate_right, 1)\n--- RESPONSE EXAMPLE END ---"
    },
    "base_module": {
        "system_prompt": "You are an AI assistant playing Tetris. Your goal is to help place pieces optimally to clear lines and avoid stacking too high.\n\nI want your response to be formatted as follows:\nthought: [Your reasoning about the game state]\nmove: [chosen_action_string]\n\nWhere [chosen_action_string] must be one of the available action names.",
        "prompt": "Analyze this Tetris game state and plan the optimal next move.\n\nCurrent Game State (primary representation):\n{textual_representation}\n\nInterpreting Game State Information:\n1. If `processed_visual_description` is available and contains structured data (e.g., \"board_state\", \"active_piece\", \"next_pieces_ids\", \"game_stats\"), prioritize using these fields for your analysis. This comes from the Perception Module.\n2. If `processed_visual_description` is not available or lacks detail, use `textual_representation`. This text typically includes:\n    - The game board as a 2D array (where non-zero values represent pieces, and the active piece is already rendered on this board).\n    - \"N:[next_piece_ids]\" for upcoming pieces.\n    - \"S:score L:lines_cleared V:level\" for game statistics.\n3. If image is available, you can use it for visual context, especially if you are a multimodal model.\n4. From the available information, identify the current board layout, the active falling piece, its shape, and upcoming pieces.\n\nTetris Game Mechanics:\n1. The game board is a grid where pieces (tetrominoes) fall from the top.\n2. Your goal is to clear lines by filling all cells in a row, which removes that row.\n3. The game ends if the pieces stack up to the top of the board.\n\nTetromino Shapes (refer to `active_piece.shape_matrix` in `processed_visual_description` if available, otherwise infer from `textual_representation`):\nI-piece, O-piece, T-piece, L-piece, J-piece, S-piece, Z-piece descriptions... (details omitted for brevity but assumed available if needed by LLM)\n\nAvailable Actions (Format: move: (action_name_from_list, frame_count) where frame_count is 1-10 and action_name_from_list MUST be one of the following exact strings):\n- \"no_op\": Do nothing for this step.\n- \"left\": Move the current piece one cell to the left.\n- \"right\": Move the current piece one cell to the right.\n- \"rotate_left\": Rotate the current piece 90 degrees counter-clockwise.\n- \"rotate_right\": Rotate the current piece 90 degrees clockwise.\n- \"soft_drop\": Move the current piece one cell down.\n- \"hard_drop\": Instantly drop the current piece to its lowest possible position.\n\nGuidelines for planning:\n1. Carefully analyze the information from `processed_visual_description` and/or `textual_representation`.\n2. If using `textual_representation`, remember the board shown already includes the active piece. Determine its shape and position.\n3. Use `reflection` and `game_trajectory` for high-level strategic guidance and historical context.\n4. Aim to create complete lines and avoid creating holes.\n5. Think about the immediate best moves for the current step.\n\nYour task is to select the best moves for the current piece and board state.\n\nExample response (adapt based on available information):\nthought: [Your detailed reasoning. If `textual_representation` is primary, describe the inferred active piece, e.g., \"The textual_representation shows an L-piece near the top. Rotating it right...\" If `processed_visual_description` is primary, use its fields. The `reflection` suggests X.]\nmove: rotate_right\n\nFormat your response exactly as follows:\nthought: [Your detailed reasoning about the optimal move and why, using all available information fields]\nmove: (action_name_from_list, frame_count)"
    },
    "perception_module": {
        "system_prompt": "You are a Tetris Perception AI. Your task is to analyze the game state (either from an image or textual description) and return a structured JSON representation. Do not suggest moves.",
        "prompt": "Analyze the provided Tetris game state information.\n\nInput will be a textual description of the game state, including the main board, the active (falling) piece, and upcoming pieces in the queue. It may also include current score, lines cleared, and level.\nExample input format (actual format might vary slightly but will contain similar information):\nBoard:\n[[0,0,1,1,0,0,0,0,0,0],\n [0,0,1,1,0,0,0,0,0,0],\n ... (more rows) ...\n [2,2,2,0,0,3,3,3,0,0]]\nActive Piece ID: 4 (e.g., L-shape)\nActive Piece Matrix: [[1,0],[1,0],[1,1]] (representing its current rotation)\nActive Piece Position (row, col of top-left on board): (0, 3)\nNext Piece IDs: [5, 2, 0] (e.g., J-shape, T-shape, I-shape)\nScore: 120\nLines: 5\nLevel: 1\n\n\nOutput a JSON object with the following structure:\n{\n  \"board_dimensions\": {\"rows\": R, \"cols\": C}, // Dimensions of the playable area\n  \"board_state\": [[id, id, ...], ...], // 2D array of piece IDs for landed pieces\n  \"active_piece\": {\n    \"id\": piece_id, // Integer ID of the falling piece\n    \"shape_matrix\": [[0,1,0], [1,1,1], ...], // 2D array showing its current rotation and shape\n    \"position\": {\"row\": r, \"col\": c} // row, col of the top-left of its shape_matrix on the main board\n  },\n  \"next_pieces_ids\": [id1, id2, ...], // List of integer IDs for upcoming pieces\n  \"game_stats\": {\n    \"score\": current_score,\n    \"lines_cleared\": lines_cleared_total,\n    \"level\": current_level\n  }\n}\n\nInstructions for deriving JSON fields:\n1.  `board_dimensions`: Determine R (height) and C (width) from the main game board input.\n2.  `board_state`: Represent the main game board. This should only contain IDs of pieces that have already landed. The active falling piece should NOT be part of this `board_state` array; its representation is separate.\n3.  `active_piece`:\n    *   `id`: The ID of the currently falling tetromino.\n    *   `shape_matrix`: The 2D array representing the active piece's current shape and rotation.\n    *   `position`: The (row, column) coordinates on the main board where the top-left corner of the `shape_matrix` is currently located.\n4.  `next_pieces_ids`: List of IDs for the tetrominoes in the upcoming queue.\n5.  `game_stats`: Extract score, lines cleared, and current level from the input."
    }
}