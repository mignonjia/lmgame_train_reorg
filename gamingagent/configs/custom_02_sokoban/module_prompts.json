{
    "perception_module": {
        "prompt": "Your task is to analyze the provided image of a Sokoban game board and describe its current state.\nIdentify and list the coordinates (row, col) of all key game elements. The top-left corner is (0,0).\n\n**Key Game Element Characters to Identify:**\n*   `#`: Wall\n*   ` `: Floor (empty space)\n*   `@`: Player (worker) on Floor\n*   `$`: Box on Floor\n*   `?`: Target location (empty)\n*   `*`: Box on a Target\n*   `+`: Player on a Target\n\nFollow these instructions carefully:\n\n1.  **Player (`@` or `+`):** Identify all player instances. Report their locations and specify if they are on a Target (becomes character `+`) or Floor (character `@`).\n2.  **Boxes (`$` or `*`):** Identify all box instances. Report their locations and specify for each if it is on a Target (becomes character `*`) or Floor (character `$`)\n3.  **Empty Targets (`?`):** Identify the locations of all Target squares that are currently empty (character `?`).\n4.  **Walls (`#`):** Identify the locations of all Wall segments (character `#`).\n5.  **Floor Spaces (` `):** Implicitly, any square not occupied by the above is a Floor space (character ` `). You don't need to list all floor spaces, but be aware of them for context.\n\nDescribe the board by listing the coordinates for each type of element. Do not attempt to interpret game strategy or suggest moves.\nFocus on accurate identification and clear reporting of element positions.\n\nExample input: An image of a Sokoban board.\n\nExample output format (illustrative, adapt to actual findings):\nPlayer: (3,4, on_target=True)  // Example: Player at (3,4) is on a target square.\nBoxes: [(2,2, on_target=False), (5,1, on_target=True)] // Box at (2,2) is on floor, Box at (5,1) is on target.\nEmpty Targets: [(1,1), (5,5)] // These are ' ? ' squares.\nWalls: [(0,0), (0,1), (0,2), (1,0), (1,2), (2,0), (2,3), ...etc.]",
        "system_prompt": "You are a visual perception AI assistant for the Sokoban game. Your task is to accurately extract and report the positions of all visible game elements (player, boxes, targets, walls) from an image of the game board, using a clearly defined set of characters for each element. Focus on precision, clarity, and structured output. Do not infer game state or suggest actions."
    },
    "memory_module": {
        "reflection": {
            "prompt": "Please analyze the following Sokoban game states and actions to generate a brief reflection:\n\nPrevious Context (older â†’ newer):\n{prev_context}\n\nCurrent Game State:\n{current_observation}\n\nFocus your reflection on:\n1. How the game state changed after the last action (e.g., player moved, box pushed, box reached target, no change).\n2. Whether the action was effective and aligned with the thought process (e.g., moved closer to a box, pushed a box towards a target, got stuck, achieved intended sub-goal).\n3. Patterns or issues to be aware of (e.g., potential deadlocks, inefficient moves, box blocking, opportunities for multiple box pushes, player positioning issues).\n4. Any strategic insights for future actions (e.g., which box to focus on, areas to clear, player positioning, deadlock avoidance strategies).\n\nKeep your reflection under 100 words and focus only on the most important insights for solving the Sokoban puzzle.",
            "system_prompt": "You are an analytical assistant for a Sokoban AI agent. Your task is to generate a brief, insightful reflection on the game state changes and the effectiveness of recent actions. Focus on strategic insights, potential deadlocks, and patterns that would help the agent make better decisions to solve the Sokoban puzzle. The current game state will be provided as a string representation of a 2D list of characters. Keep your reflections short, precise, and actionable."
        }
    },
    "reasoning_module": {
        "prompt": "##Previous Action/Thought\n{game_trajectory}\n\n## Current Sokoban Board State\n{textual_representation}\n\n## Task\nAnalyze the current board state (provided above), your previous action/thought AND reflection. Decide the single best action for the worker. Your goal is to push all boxes onto the designated dock locations.\n\n**Rules:**\n- You can **move** Up, Down, Left, Right onto empty floor or docks.\n- You can **push** a box Up, Down, Left, Right if the space beyond it is empty.\n- Avoid deadlocks (pushing boxes into corners unnecessarily).\n\n**Instructions:**\n1. Review the current board and your last action/thought.\n2. Determine the next best action: `up`, `down`, `left`, `right` to **move**, OR `push up`, `push down`, `push left`, `push right` to **push** a box.\n3. Briefly explain your reasoning.\n\nYour response format MUST be:\nthought: [Your reasoning about the game state and planned action. Refer to the CURRENT BOARD STATE below. Clearly state if moving the player or pushing a box. Consider potential deadlocks.]\nmove: [action]\n\nAvailable Actions: \"up\", \"down\", \"left\", \"right\", \"push up\", \"push down\", \"push left\", \"push right\".\n\n**Example:**\nthought: Moving right to get behind the box.\nmove: push up",
        "system_prompt": "You are an intelligent AI player solving a Sokoban puzzle. Your goal is to make strategic moves to push all boxes onto their designated target locations, based on the provided board state."
    },
    "base_module": {
        "prompt": "Sokoban Game Quick Guide:\nPrimary Goal: Push all boxes ('$') onto all target locations ('?'). A box on a target becomes '*'. A player on a target becomes '+'.\nGame Mechanics & Action Choice:\n- The game is played on a grid using the following characters:\n    '#': Wall\n    ' ': Floor (empty space)\n    '@': Player (worker)\n    '$': Box\n    '?': Target location (empty)\n    '*': Box on a target\n    '+': Player on a target\n- To move the Player ONLY: Use actions: \"up\", \"down\", \"left\", \"right\". Player moves to an empty Floor (' ') or empty Target ('?').\n- To push a Box: If the Player is adjacent to a Box ('$' or '*') AND you want to move that Box, you MUST use actions: \"push up\", \"push down\", \"push left\", \"push right\". The square beyond the box must be an empty Floor (' ') or empty Target ('?').\n- Player cannot push a Box into a Wall ('#') or another Box.\n- The game is solved when all boxes are on target locations (all boxes are '*').\n\nKey Strategies:\n1. Box pushing order: Think carefully about which boxes to push first.\n2. Avoid deadlocks: Do not push boxes into corners (unless it's a target) or against walls where they cannot be moved out.\n3. Player positioning: Position the player to push boxes effectively.\n\nYour response format MUST be:\nthought: [Your reasoning about the game state and planned action. Clearly state if moving the player or pushing a box. Consider potential deadlocks.]\nmove: [action]\n\nAvailable Actions: \"up\", \"down\", \"left\", \"right\", \"push up\", \"push down\", \"push left\", \"push right\".\n\nSOURCE OF GAME STATE INFORMATION:\nThe game state can be provided through different observation modes:\n\n**VISION MODE**: If you have access to an image (img_path provided), use visual analysis to understand the current board state. The textual_representation may be null/empty - this is normal and expected.\n\n**TEXT MODE**: If you have access to textual_representation, use it as your primary source. This is a string representation of a 2D list of characters (e.g., \"[['#', '@'], [' ', '?']]\"), where each inner list is a row of the Sokoban puzzle.\n\n**BOTH MODE**: If you have access to both image and textual_representation, use both sources to get the most complete understanding.\n\nIMPORTANT DECISION LOGIC:\n- If you have an image available (img_path is provided), analyze the visual board state from the image to make your decision.\n- If you have textual_representation available and it contains valid board data, use it to understand the game state.\n- If you have both sources available, use both for a comprehensive analysis.\n- ONLY skip if you have neither a valid image nor valid textual representation available.\n\nCURRENT BOARD STATE:\nTextual Representation: {textual_representation}\nImage Available: {img_path}\n\nBased on the available information above, analyze the situation and provide your thought process and next move.",
        "system_prompt": "You are an intelligent AI player solving a Sokoban puzzle. Your goal is to make strategic moves to push all boxes onto their designated target locations. You can work with visual observations (images), textual representations, or both, depending on the observation mode configured for the game."
    }
}
